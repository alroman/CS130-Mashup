$(document).ready(function(){function a(){if(markerArray)for(marker in markerArray)markerArray[marker].setMap(null)}function b(b){var e=b.find("input:checked"),f=b.attr("action"),g={"category[]":[]};$.each(e,function(a,b){var c=$(b).val();g["category[]"].push(c)});g.events=all_events;$.post(f,g,function(b){a();d(b);c(b);if(b.error)return!1;$(b).each(app.updateMap)},"json");return!1}function c(a){var b=$("#dest"),c=$("#calendar"),d=$("#eventCalendar");b.empty();c.empty();event_cal.emptyEvents();event_cal.initEvents(a);event_cal.constructEventsList();event_cal.generateCalendar()}function d(a){var b=$(".event_list"),c=b.children();c.remove();if(a.error){b.append("<div class='event_title'>Sorry, no event.</div>");return!1}$(a).each(function(a,c){b.append("<div class='event_title'>"+c.title+"</div>")})}markerArray===undefined&&alert("markerArray is undefined, please fixed it in the footer.php");all_events===undefined&&alert("all_events is undefined, please fixed it in the footer.php");$(".tag").live("click",function(){var a=$(this),c=a.find("input");a.toggleClass("active");c.is(":checked")?c.prop("checked",!1):c.prop("checked",!0);var d=$("#tag_form");b(d);return!1});var e={trigger:$("#addTags"),tagWrapper:$("#tag-wrapper")};e.initEvents=function(){e.trigger.click(function(){var a="<input class='span2' type='text' id='tag-input' name='tag-input' placeholder='Tag' style='padding: 1px 5px; margin-left: 5px;'></input>";$(this).hide().after(a);var b=$("#tag-input");b.focus();b.focusout(function(){$(this).remove();e.trigger.show()});e.ajaxifyInput(b)})};e.ajaxifyInput=function(a){a.keypress(function(c){if(c.which==13){c.preventDefault();var d=a.val(),f=$("#tag_form");if(e.validateInput(d,f)){var g='<li><div class="input-prepend"><label class="add-on tag active"><input value='+d+' type="checkbox" class="tag_checkbox" style="display:none;" checked="true"><span class="tags_text">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+d+"</span></label></div></li>";a.remove();e.tagWrapper.before(g);e.trigger.show();b(f)}}})};e.validateInput=function(a,b){var c=b.find("input:checked"),d=!0;$.each(c,function(b,c){var e=$(c).val();if(a.toLowerCase()==e.toLowerCase()){alert("Your input is not valid, please try again.");d=!1;return d}});return d};e.initEvents();var f=places;window.event_cal={events:null,eventList:new Array,eventDateList:new Array};var g=new Date,h=g.getDate(),i=g.getMonth(),j=g.getFullYear();event_cal.initEvents=function(a){event_cal.events=a};event_cal.emptyEvents=function(){event_cal.events=null;event_cal.eventList=new Array;event_cal.eventDateList=new Array};event_cal.parse_date=function(a){var b=String(a).split(/[- :]/),c=new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5]);return c};event_cal.constructEventsList=function(){$.each(event_cal.events,function(a,b){var c={title:b.title,start:b.start_time,end:b.stop_time,allDay:!1};event_cal.eventList.push(c);var d=event_cal.parse_date(b.start_time);event_cal.eventDateList.push(d.toDateString())})};event_cal.generateCalendar=function(){var a=$("#calendar").fullCalendar({header:!1,height:300,contentHeight:200,editable:!1,defaultView:"agendaDay",slotMinutes:60,allDaySlot:!1,firstHour:0,events:event_cal.eventList}),b=$("#dest").calendarPicker({enableYears:!1,months:1,days:3,eventDates:event_cal.eventDateList,callback:function(b){a.fullCalendar("gotoDate",b.currentDate)}});$("table.fc-agenda-slots tr:even").addClass("tr_odd")};event_cal.initEvents(f);event_cal.constructEventsList();event_cal.generateCalendar()});